<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Meu portal de notícias</title>
    <link rel="stylesheet" href="./main.css" />
    <script type="text/javascript" src="./news.js"></script>
  </head>
  <body>
    <header>
      <div class="container">
        <h1>Meu portal de notícias</h1>
        <nav>
          <ul>
            <li>
              <a href="#sports" title="Ir para a seção de esportes">Esportes</a>
            </li>
            <li>
              <a href="#economy" title="Ir para a seção de notícias"
                >Economia</a
              >
            </li>
            <li>
              <a href="#entertainment" title="Ir para a seção de entretenimento"
                >Entretenimento</a
              >
            </li>
            <li>
              <a href="#tecnologia" title="Ir para a seção de tecnologia"
                >Tecnologia</a
              >
            </li>
          </ul>
        </nav>
      </div>
    </header>
    <section id="sports">
      <div class="container">
        <h2>Esportes</h2>
        <div class="articles"></div>
      </div>
    </section>
    <section id="economy">
      <div class="container">
        <h2>Economia</h2>
        <div class="articles"></div>
      </div>
    </section>
    <section id="entertainment">
      <div class="container">
        <h2>Entretenimento</h2>
        <div class="articles"></div>
      </div>
    </section>
    <section id="technology">
      <div class="container">
        <h2>Tecnologia</h2>
        <div class="articles"></div>
      </div>
    </section>
    <script>
      const articleTemplateFunction = ({
        picture,
        time,
        headline,
        text,
        cta,
      }) => `
<article>
    <img src="${picture.src}" alt="${picture.alt}" />
    <header>
        <time>${time}</time>
    </header>
    <h3>${headline}</h3>
    <p>
        ${text}
    </p>
    <a href="${cta.href}" title="${cta.title}">Ler mais</a>
</article>`;

      const categories = responseFromBackend
        .map(({ type }) => type)
        .reduce(
          (acc, curr) => (acc.indexOf(curr) === -1 ? acc.concat(curr) : acc),
          []
        );

      const groupNewsByCategories = categories.reduce(
        (acc, curr) => ({
          ...acc,
          [curr]: responseFromBackend.filter(({ type }) => type === curr),
        }),
        {}
      );

      // Magic
      // As long as the section names matches the category names, this will work
      const sectionIds = Array.from(document.querySelectorAll("section"))
        .map((el) => el.getAttribute("id"))
        .forEach((id) => {
          const section = document.getElementById(id);
          const targetArticle = section.querySelector("div.articles");
          const news = groupNewsByCategories[id];
          const articles = news.map(articleTemplateFunction).join("");
          targetArticle.innerHTML = articles;
        });
    </script>
  </body>
</html>
